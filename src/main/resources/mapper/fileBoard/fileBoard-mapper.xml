<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fileBoard">
  <insert id="insertFileAttach">
  	insert into
			attachment
		values(
			seq_attach_no_no.nextval,
			#{memberId},
			#{groupNo},
			#{originalFilename},
			#{renamedFilename},
			current_date,
			'N',
			default
		)
  </insert>
  <insert id="insertFilePost">
  <selectKey keyProperty="attachNo" resultType="_int" order="BEFORE">
			select
				seq_attach_no_no.currval
			from
				dual
		</selectKey>
  insert into
  	post
  	values
  	(
  		seq_post_no_no.nextval,
  		#{memberId},
  		#{boardNo},
  		#{postTitle},
  		null,
  		current_date,
  		null,
  		#{attachNo},
  		#{boardCategoryNo}
  		)
  	
  </insert>

  <select id="selectAllPostInfileBoard" resultType="PostWithCategory">
  		select
	    p.*,
	    bc.board_category
	from
	    post p left join board_category bc
	        on p.board_category_no = bc.board_category_no 
	where board_no = #{boardNo}
  </select>
  	
  <select id="selectAttachmentList" resultType="attachment">
  select*from attachment
  </select>
  
  <select id="selectOneAttachment" resultType="attachment">
		select
			*
		from
			attachment
		where
			attach_no = #{attachNo}
	</select>
	
	<delete id="deleteFilePost" >
		delete from post where post_no =#{postNo}
	</delete> 

	<delete id="deleteOneAttach" >
		delete from attachment where attach_no =#{attachNo}
	</delete> 
	
<!--파일보드 검색쿼리 -->
	<select id="selectAllFileBoardListByParam" resultType="PostWithCategory">
	 select 
	         p.*,
	         bc.board_category
	         from
	  post p join board_category bc
	    on 
	  p.board_category_no = bc.board_category_no
	<where>		
		  p.board_category_no in (5,6,7,8,9) 
		<if test="searchType == 'all'">
			 and member_id like '%'||#{searchKeyword}||'%' or post_title like '%'||#{searchKeyword}||'%'
		</if>
	<!-- 	<if test="searchType == 'img'">
			 and member_id like '%'||#{searchKeyword}||'%' or post_title like '%'||#{searchKeyword}||'%'
		</if>		
		<if test="searchType == 'code'">
			 and group_location like '%'||#{searchKeyword}||'%'
		</if>	 -->
	</where>
		order by post_reg_date desc
	</select>
</mapper>