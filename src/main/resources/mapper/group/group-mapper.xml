<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="group">
  <insert id="insertGroup">
	insert into 
		tb_group
	values(
		seq_group_no.nextval,
		#{categoryNo},
		#{groupName},
		default,
		#{groupCharge},
		default,
		#{groupPool},
		#{groupPrivate},
		default,
		#{groupLocation}
	)
  </insert>
	<insert id="insertAttach">
		<selectKey keyProperty="groupNo" resultType="_int" order="BEFORE">
			select
				seq_group_no.currval
			from
				dual
		</selectKey>
		insert into
			attachment
		values(
			seq_attach_no_no.nextval,
			#{id},
			#{groupNo},
			#{originalFilename},
			#{renamedFilename},
			sysdate,
			#{imgFlag},
			default
		)
	</insert>
 	<insert id="insertGroupInfoConnect">
 		<selectKey keyProperty="groupNo" resultType="_int" order="BEFORE">
			select
				seq_group_no.currval
			from
				dual
		</selectKey>
		insert into 
			group_groupinfo
		values(
			seq_g_gi_no.nextval,
			#{groupNo},
			#{giTitle}
		)
 	</insert>
 	<insert id="insertGroupInfo">
 		<selectKey keyProperty="seqNo" resultType="_int" order="BEFORE">
			select
				seq_g_gi_no.currval
			from
				dual
		</selectKey>
		insert into
			groupinfo
		values(
			seq_gi_no_no.nextval,
			#{seqNo},
			#{giSubTitle},
			#{giContent}
		)
	</insert>
	<select id="groupgroupContOne" resultType="CategoryOne">
		select * from studygroup_category1 order by category1_no asc
	</select>
	
	<select id="groupgroupContTwo" resultType="CategoryTwo">
		select * from studygroup_category2 where category1_no = #{categoryOneNo} order by category2_no asc
	</select>
	
	<insert id="insertGroupCategory">
		<selectKey keyProperty="groupNo" resultType="_int" order="BEFORE">
				select
					seq_group_no.currval
				from
					dual
			</selectKey>
		insert into group_category values (seq_group_category_no.nextval , #{groupNo} ,#{category2No})
	
	</insert>
	
	<insert id="insertAlg">
		<selectKey keyProperty="groupNo" resultType="_int" order="BEFORE">
				select
					seq_group_no.currval
				from
					dual
			</selectKey>
		insert into applocation_group values(seq_alg_no_no.nextval,#{memberId},#{groupNo},default,null,'G')
	
	</insert>
	<select id="selectGroupTotalCount" resultType="_int">
	select count(*) from 
	<if test="ca2No == 0">
		tb_group
	</if>
	<if test="ca2No != 0">
	tb_group t left join group_category g using(group_no) 
	</if>
	<where>
		<if test="ca1No != 0">
			category_no = #{ca1No}
		</if>
		<if test="ca2No != 0">
			and category2_no = #{ca2No}
		</if>
		<if test="searchType == 'groupName'">
			 and group_name like '%'||#{searchKeyword}||'%' 
		</if>
		<if test="searchType == 'location'">
			 and group_location like '%'||#{searchKeyword}||'%'
		</if>
		
	</where>
	</select>
	<select id="selectAllMyGroupList" resultType="group">
	select * from tb_group
	</select>
	
	<select id="selectAllGroupList" resultType="group">
	select * from tb_group
	</select>
	
	<select id="selectAllGroupInfoList" resultType="groupInfoConnect">
	select * from group_groupinfo
	</select>
	<select id="selectAllGroupListByCa1No" resultType="group">
	select * from tb_group where category_no = #{ca1No}
	</select>
	<select id="selectAllGroupListByCa2No" resultType="group">
	select * from tb_group t left join group_category g using(group_no) where category2_no = #{ca2No}
	</select>
	
	<select id="selectAllGroupListByParam" resultType="group">
	select * from 
	<if test="ca2No == 0">
		tb_group
	</if>
	<if test="ca2No != 0">
	tb_group t left join group_category g using(group_no) 
	</if>
	<where>
		<if test="ca1No != 0">
			category_no = #{ca1No}
		</if>
		<if test="ca2No != 0">
			and category2_no = #{ca2No}
		</if>
		<if test="searchType == 'groupName'">
			 and group_name like '%'||#{searchKeyword}||'%' 
		</if>
		<if test="searchType == 'location'">
			 and group_location like '%'||#{searchKeyword}||'%'
		</if>
		
	</where>
	</select>
	
	<select id="selectGroupListByGroupNo" resultType="group">
	select * from tb_group where group_no = #{groupNo}
	</select>
	
	<select id="selectAllGroupInfoByGroupNo" resultType="GroupInfoConnect">
	select * from group_groupinfo where group_no = #{groupNo}
	</select>
	
	<select id="selectGroupInfoListByGsNo" resultType="GroupInfo">
	select * from groupinfo where seq_no = #{gsNo}
	</select>
	
	<select id="selectCategoryOneByCateNo" resultType="CategoryOne">
	select * from studygroup_category1 where category1_no = #{cateNo}
	</select>
	
	<select id="selectGroupCategoryListByGroupNo" resultType="GroupCategory">
	select * from group_category where group_no = #{groupNo}
	</select>
	
	<select id="selectCategoryTwoListByGroupNo" resultType="CategoryTwo">
	select * from studygroup_category2 where category2_no = #{num}
	</select>
	
	<insert id="insertGroupJoin">
	insert into applocation_group values(seq_alg_no_no.nextval, #{memberId}, #{groupNo}, default, #{answer}, default)
	</insert>
	
	<select id="selectgroupLike" resultType="_int"  parameterType="hashmap" >
	select count(*) from interest_group where group_no = #{groupNo} and member_id = #{memberId}
	</select>
	
	<delete id="deletegroupLike" parameterType="hashmap">
	 delete from interest_group where group_no = #{groupNo} and member_id = #{memberId}
	</delete>
	
	<insert id="insertgroupLike" parameterType="hashmap">
	insert into interest_group values (seq_inter_no_no.nextval,#{memberId},#{groupNo})
	</insert>
	
	<select id="selectCountGroupLike" resultType="_int">
		select group_like_count  from tb_group where group_no =#{groupNo}
	</select>	
	
	<update id="updateGroupLikeCount">
		update tb_group set group_like_count = #{newCount} where group_no =#{groupNo}
	</update>
</mapper>