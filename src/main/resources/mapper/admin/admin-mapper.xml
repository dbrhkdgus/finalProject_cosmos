<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
  <select id="selectAllMembers" resultType="Member">
  	select
  		*
  	from
  		tb_member
  </select>
  
  <select id="selectOneMember" resultType="MemberWithGroup">
	select
	    m.*,
	    (select group_name from tb_group tb where m.group_no = tb.group_no) "GROUP_NAME"
	from
	    (select
	        m.*,
	        group_no
	    from 
	        tb_member m 
	        left join applocation_group ag on m.id = ag.member_id
	    where 
        group_accept='N' or group_accept is null) m	
    where
	    id=#{id}
  </select>
  
  <!-- 블랙리스트 등록 및 해제 -->
   <update id="updateBlack">
  	update
  		tb_member
  	<set>
  		<if test="enabled == 'true'">enabled = 0</if>
  		<if test="enabled == 'false'">enabled = 1</if>
  	</set>
  	where
  		id = #{id}
  </update>
  
  <!-- 회원 목록 내에서 회원 검색 -->
  <select id="searchMembers" resultType="Member">
  	select
  		*
  	from
  		tb_member
  	<where>
		<if test="searchType == 'id'">
			id like '%'||#{searchKeyword}||'%'
		</if>
		<if test="searchType == 'memberName'">
			member_name like '%'||#{searchKeyword}||'%'
		</if>
		<if test="searchType == 'phone'">
			phone like '%'||#{searchKeyword}||'%'
		</if>
		<if test="searchType == 'gender'">
			member_gender like '%'||#{searchKeyword}||'%'
		</if>
		
	
  	</where>
  </select>
  
  <!-- 미승인 그룹리스트 조회 -->
  <select id="selectNotApprovedAGList" resultType="ApplocationGroup">
  	select 
  		* 
  	from 
  		applocation_group 
  	where 
  		role = 'G' and group_accept ='N'
  
  </select>
  
</mapper>